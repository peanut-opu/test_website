<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é»‘æ½®å±•ç¤ºï½œKuroshio Demo</title>
  <style>
    :root{
      --bg:#0b1220; --card:#111a2e; --text:#eaf0ff; --muted:#a9b4d0;
      --accent:#4da3ff; --accent2:#ff4d6d;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "PingFang TC", "Noto Sans TC", Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, #142449 0%, var(--bg) 55%) fixed;
      color:var(--text);
    }
    header{
      padding:28px 18px 10px;
      text-align:center;
    }
    header h1{margin:0 0 6px; font-size:28px; letter-spacing:.5px}
    header p{margin:0; color:var(--muted); line-height:1.6}
    .wrap{max-width:1100px; margin:18px auto 60px; padding:0 14px}
    .grid{
      display:grid; gap:16px;
      grid-template-columns: 1.2fr .8fr;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns: 1fr}
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      transform: translateY(0);
      transition: transform .18s ease, border-color .18s ease;
    }
    .card:hover{ transform: translateY(-3px); border-color: rgba(77,163,255,.35); }

    .card .hd{
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(6px);
    }
    .title{font-weight:700}
    .meta{color:var(--muted); font-size:13px}

    .body{padding:14px 16px}

    .imgbox{
      width:100%;
      background:#0a1020;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      overflow:hidden;
      position:relative;
    }
    img.plot{
      width:100%;
      display:block;
      transform: scale(1);
      transition: transform .25s ease;
    }
    .imgbox:hover img.plot{ transform: scale(1.01); }

    .toolbar{
      display:flex; flex-wrap:wrap; gap:10px;
      margin-top:12px;
      align-items:center;
    }
    button{
      border:0;
      padding:10px 12px;
      border-radius:12px;
      color:var(--text);
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-weight:600;
    }
    button:hover{ transform: translateY(-1px); border-color: rgba(77,163,255,.35); }
    button.primary{ background: rgba(77,163,255,.18); border-color: rgba(77,163,255,.45); }
    button.danger{ background: rgba(255,77,109,.16); border-color: rgba(255,77,109,.35); }

    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:var(--muted);
      font-size:13px;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    input[type="range"]{width:240px}
    .note{color:var(--muted); font-size:13px; margin-top:8px; line-height:1.55}

    .fadeIn{ animation: fadeIn .35s ease; }
    @keyframes fadeIn{
      from{opacity:.2; transform: translateY(4px)}
      to{opacity:1; transform: translateY(0)}
    }

    footer{
      margin:26px auto 0;
      padding:18px 16px;
      max-width:1100px;
      text-align:center;
      color:var(--muted);
      font-size:14px;
      border-top:1px solid rgba(255,255,255,.10);
    }
    footer a{ color:var(--text); text-decoration:none; border-bottom:1px dotted rgba(255,255,255,.35); }
    footer a:hover{ border-bottom-color: rgba(77,163,255,.8); }
  </style>
</head>

<body>
  <header>
    <h1>é»‘æ½®å±•ç¤ºï½œKuroshio Demo</h1>
    <p>
      å±•ç¤ºé‡é»ï¼šå·¦é‚Šã€Œç©ºé–“åˆ†ä½ˆåœ–ï¼ˆå«å°ç£ä½ç½®ï¼‰ã€ã€å³é‚Šã€Œæ™‚é–“åºåˆ—åœ–ã€ã€‚<br>
      ç¾å ´ç¶²è·¯å·®ä¹Ÿæ²’é—œä¿‚ï¼šæŠŠåœ–ç‰‡å…ˆæ”¾åœ¨ GitHub Pages ä¸Šå°±èƒ½å±•ç¤ºã€‚
    </p>
  </header>

  <div class="wrap">
    <div class="grid">

      <!-- å·¦ï¼šç©ºé–“åœ–ï¼ˆåœ°åœ–/æµé€Ÿï¼‰ -->
      <section class="card">
        <div class="hd">
          <div>
            <div class="title">ç©ºé–“åˆ†ä½ˆåœ–ï¼ˆæµé€Ÿ/æµ·æº«ï¼‰</div>
            <div class="meta" id="mapMeta">Frame: 0</div>
          </div>
          <span class="pill" id="mapStatus">ğŸŸ¢ Ready</span>
        </div>

        <div class="body">
          <div class="imgbox">
            <img id="mapImg" class="plot fadeIn" src="kuroshio_map_000.png" alt="Kuroshio map">
          </div>

          <div class="toolbar">
            <button class="primary" id="btnPlay">é–‹å§‹</button>
            <button id="btnPause">æš«åœ</button>
            <button id="btnNext">ä¸‹ä¸€å¼µ</button>
            <button class="danger" id="btnLatest">å›åˆ°æœ€æ–°</button>
            <button id="btnHardRefresh">å¼·åˆ¶æ›´æ–°</button>

            <span class="pill">é€Ÿåº¦ï¼š<span id="speedLabel">1.0x</span></span>
            <input id="speed" type="range" min="0.25" max="3" step="0.25" value="1">
          </div>

          <div class="note">
            ä½ ä¹‹å¾Œåšå‹•ç•«æ™‚ï¼ŒæŠŠåœ–ç‰‡å‘½åæˆï¼š<b>kuroshio_map_000.png ~ kuroshio_map_0NN.png</b> å°±æœƒçœŸçš„å‹•ã€‚<br>
            ç¾åœ¨å¦‚æœåªæœ‰ 1 å¼µä¹Ÿèƒ½å…ˆå±•ç¤ºï¼ˆæŒ‰ä¸‹ä¸€å¼µæœƒåœåœ¨æœ€å¾Œï¼‰ã€‚
          </div>
        </div>
      </section>

      <!-- å³ï¼šæ™‚é–“åºåˆ—åœ– -->
      <aside class="card">
        <div class="hd">
          <div>
            <div class="title">æ™‚é–“åºåˆ—åœ–ï¼ˆæµé€Ÿ/ç™¼é›»é‡ï¼‰</div>
            <div class="meta" id="tsMeta">å›ºå®šåœ–ï¼škuroshio_timeseries_2024.png</div>
          </div>
          <span class="pill">ğŸ“ˆ Time series</span>
        </div>

        <div class="body">
          <div class="imgbox">
            <img id="tsImg" class="plot fadeIn" src="kuroshio_timeseries_2024.png" alt="Kuroshio timeseries">
          </div>

          <div class="row" style="margin-top:12px">
            <button id="btnTSRefresh">æ›´æ–°æ™‚é–“åºåˆ—åœ–</button>
          </div>

          <div class="note">
            å¦‚æœä½ é‡æ–°è¼¸å‡ºåŒæª”åï¼ˆä¾‹å¦‚å†å­˜ä¸€æ¬¡ <b>kuroshio_timeseries_2024.png</b>ï¼‰ï¼ŒæŒ‰ã€Œæ›´æ–°ã€å¯ä»¥å¼·åˆ¶æ¸…å¿«å–ã€‚
          </div>
        </div>
      </aside>

    </div>
  </div>

  <footer>
    Contact<br>
    <a href="mailto:baby56789767644@gmail.com">baby56789767644@gmail.com</a><br>
    <a href="mailto:01481002@mail.ntou.edu.tw">01481002@mail.ntou.edu.tw</a>
  </footer>

  <script>
    // ============ è¨­å®šå€ï¼šä½ ä»¥å¾Œåªè¦æ”¹é€™äº› ============
    const MAP_PREFIX = "kuroshio_map_";
    const EXT = ".png";

    // ä½ æœ€å¤šå¯èƒ½æœƒæœ‰å¹¾å¼µï¼Ÿå…ˆå¡« 120 å¼µã€‚æ²’æœ‰é‚£éº¼å¤šä¹Ÿæ²’é—œä¿‚ï¼Œæœƒè‡ªå‹•åœåœ¨æœ€å¾Œä¸€å¼µã€‚
    let MAX_FRAMES = 120;

    // ============ ç‹€æ…‹ ============
    let frame = 0;
    let timer = null;
    let speed = 1.0;

    const mapImg = document.getElementById("mapImg");
    const tsImg  = document.getElementById("tsImg");
    const mapMeta = document.getElementById("mapMeta");
    const mapStatus = document.getElementById("mapStatus");
    const speedSlider = document.getElementById("speed");
    const speedLabel  = document.getElementById("speedLabel");

    function pad3(n){ return String(n).padStart(3,"0"); }

    // å¼·åˆ¶ä¸åƒå¿«å–ï¼ˆæ¯æ¬¡åŠ ä¸€å€‹æ™‚é–“æˆ³ queryï¼‰
    function bustCache(url){
      const sep = url.includes("?") ? "&" : "?";
      return url + sep + "v=" + Date.now();
    }

    function setMapFrame(n){
      frame = Math.max(0, n);
      const src = `${MAP_PREFIX}${pad3(frame)}${EXT}`;
      mapImg.classList.remove("fadeIn");
      void mapImg.offsetWidth;
      mapImg.classList.add("fadeIn");
      mapImg.src = bustCache(src);
      mapMeta.textContent = `Frame: ${frame}`;
    }

    function play(){
      if(timer) return;
      mapStatus.textContent = "ğŸŸ¢ Playing";
      const interval = Math.max(120, 650 / speed);
      timer = setInterval(()=> setMapFrame(frame + 1), interval);
    }

    function stop(){
      if(timer){
        clearInterval(timer);
        timer = null;
      }
      mapStatus.textContent = "ğŸŸ¢ Ready";
    }

    // å¦‚æœåœ–ç‰‡ä¸å­˜åœ¨ï¼ˆ404ï¼‰ï¼Œä»£è¡¨è¶…å‡ºç¾æœ‰å¼µæ•¸ï¼šå›é€€ä¸€å¼µä¸¦åœæ­¢
    mapImg.addEventListener("error", ()=>{
      stop();
      if(frame > 0){
        frame -= 1;
        mapStatus.textContent = "ğŸŸ¡ Reached last frame";
        setMapFrame(frame);
      }else{
        mapStatus.textContent = "ğŸ”´ Missing image (kuroshio_map_000.png?)";
      }
    });

    // ============ æŒ‰éˆ• ============
    document.getElementById("btnPlay").addEventListener("click", play);
    document.getElementById("btnPause").addEventListener("click", stop);
    document.getElementById("btnNext").addEventListener("click", ()=> setMapFrame(frame + 1));
    document.getElementById("btnLatest").addEventListener("click", ()=>{
      stop();
      // ç›´æ¥è·³åˆ°å¾ˆå¾Œé¢ï¼Œè§¸ç™¼ error å›é€€åˆ°æœ€å¾Œä¸€å¼µ
      setMapFrame(MAX_FRAMES);
    });
    document.getElementById("btnHardRefresh").addEventListener("click", ()=>{
      // å¼·åˆ¶åˆ·æ–°ç›®å‰é€™å¼µ
      setMapFrame(frame);
    });

    document.getElementById("btnTSRefresh").addEventListener("click", ()=>{
      tsImg.src = bustCache("kuroshio_timeseries_2024.png");
    });

    // é€Ÿåº¦æ»‘æ¡¿
    speedSlider.addEventListener("input", ()=>{
      speed = parseFloat(speedSlider.value);
      speedLabel.textContent = `${speed.toFixed(2)}x`;
      if(timer){ stop(); play(); }
    });

    // åˆå§‹è¼‰å…¥
    setMapFrame(0);
  </script>
</body>
</html>
